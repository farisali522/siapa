<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Peta Digital SIAPA</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Include Styles -->
    {% include "peta/includes/map_styles.html" %}
</head>
<body>

<!-- Top Navbar -->
<nav class="navbar">
    <div class="nav-left">
        <div class="navbar-brand">
            <div class="brand-logo-small">S</div>
            <div class="brand-text-container">
                <h1>SIAPA <span>Digital Map Analysis Tool</span></h1>
            </div>
        </div>
    </div>

    <div class="nav-right">
        {% if user.is_superuser %}
        <a href="{% url 'dashboard_overview' %}" class="btn-nav-admin" style="background: white; color: var(--maroon) !important; border: 1px solid #eee;">
            <i class="fas fa-arrow-left"></i> <span class="hide-mobile">Dashboard</span>
        </a>
        <a href="/xxx/" class="btn-nav-admin" style="background: white; color: var(--maroon) !important; border: 1px solid #eee;">
            <i class="fas fa-cogs"></i> <span class="hide-mobile">Admin Panel</span>
        </a>
        <div class="header-divider hide-mobile"></div>
        {% endif %}

        <div class="user-profile-dropdown" id="profileDropdown">
            <div class="profile-trigger" onclick="toggleProfileDropdown(event)">
                <i class="fas fa-user-circle" style="font-size: 22px; opacity: 0.9;"></i>
                <span class="user-name-box" style="font-weight: 700; font-size: 13px;">
                    {{ user.username }}
                </span>
                <i class="fas fa-chevron-down" style="font-size: 10px; opacity: 0.5;"></i>
            </div>
            
            <div class="dropdown-content">
                <div class="dropdown-header">
                    <span>Logged in as</span>
                    <strong>{{ user.username }}</strong>
                </div>
                <a href="{% url 'custom_logout' %}" class="dropdown-item logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </div>
</nav>

<script>
    function toggleProfileDropdown(e) {
        e.stopPropagation();
        document.getElementById('profileDropdown').classList.toggle('active');
    }

    // Klik di mana saja untuk menutup dropdown
    window.addEventListener('click', function() {
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown && dropdown.classList.contains('active')) {
            dropdown.classList.remove('active');
        }
    });

    // Jangan tutup kalau klik di dalam kotak dropdown-nya
    document.querySelector('.dropdown-content').addEventListener('click', function(e) {
        e.stopPropagation();
    });
</script>

<!-- Main Wrapper -->
<div class="main-wrapper">
    <!-- Map Container -->
    <div id="map"></div>

    <!-- Include UI Components (Header & Footer Panel) -->
    {% include "peta/includes/map_header.html" %}
    {% include "peta/includes/map_footer.html" %}
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Include Mode Logic (Separated Files) -->
{% include "peta/modes/mode_analisis.html" %}
{% include "peta/modes/mode_pilpres.html" %}
{% include "peta/modes/mode_pileg_ri.html" %}
{% include "peta/modes/mode_pileg_prov.html" %}
{% include "peta/modes/mode_pileg_kokab.html" %}

<!-- Include Logic Scripts -->
{% include "peta/includes/map_scripts.html" %}

</body>
</html>
